{% extends "base2.html" %}

{% block title %}Show Balance{% endblock %}

{% block body %}

	<div class="container">
		<div class="col-md-10 mx-auto">
			<div class="shadow-lg app-description p-3">
				<h2 class="pl-3">Przeglądanie bilansu</h2>
				<div class="row px-3 my-3">
					<div class="ml-lg-auto">
						<label for="checkDate">Wybierz okres:</label>
					</div>	
					<div class="col-6 col-lg-4 col-xl-3">
					
						<form method="post" id="balanceForm" action="/profile/showBalance">
							<select id="selectDate" name="selectDate" class="form-control">
								<option value="1" {{ option1 }}>Bieżący miesiąc</option>
								<option value="2" {{ option2 }}>Poprzedni miesiąc</option>
								<option value="3" {{ option3 }}>Bieżący rok</option>
								<option value="4" {{ option4 }} data-toggle="modal" data-target="#myModal">Niestandardowy</option>
							</select>	
						</form>
					</div>
				</div>

				<div class="row px-3">	
					<div class="col-lg-6">
						<fieldset class="shadow-xl rounded-xl px-3 my-3">
							<h3 class="pt-3">Przychody</h3>
							<p id="incomes" style="font-size: 15px;"></p>
							
							{% if incomes %}
								<table class="table table-striped table-bordered">
									<thead>
										<tr>
											<th>Income</th>
											<th>Amount</th>
										</tr>
									</thead>
									<tbody>
										{% for income in incomes %}
											<tr>
												<td>{{ income['name'] }}</td>
												<td>{{ income['amount']}}</td>
											</tr>
										{% endfor %}
									</tbody>
								</table>
							{% else %}
								<p>Brak przychodów!</p>
							{% endif %}
						</fieldset>
					</div>
					
					<div class="col-lg-6">
						<fieldset class="shadow-xl rounded-xl pl-3 mt-3">
							<h3 class="pt-3">Wydatki</h3>
							<p id="expenses" style="font-size: 15px;"></p>
							
							{% if expenses %}
								<table class="table table-striped table-bordered">
									<thead>
										<tr>
											<th>Expense</th>
											<th>Amount</th>
										</tr>
									</thead>
									<tbody>
										{% for expense in expenses %}
											<tr>
												<td>{{ expense['name'] }}</td>
												<td>{{ expense['amount']}}</td>
											</tr>
										{% endfor %}
									</tbody>
								</table>
							{% else %}
								<p>Brak wydatków!</p>
							{% endif %}
							
						</fieldset>
					</div>
				</div>	
				
				<div class="row my-3 pt-3" id="chart-parent">
					<canvas id="chart" width="200" height="100"></canvas>
				</div>
			</div>
		</div>
	</div>
		
			<!-- Modal -->
	<div class="modal fade" id="myModal" role="dialog">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title" id="myModalLabel">Podaj okres do wyświetlenia</h4>
					<button type="button" class="close btn-close" data-dismiss="modal">&times;</button>					
				</div>
				
				<form id="modalForm" method="post" action="/profile/showCustomBalance">
				
					<div class="modal-body">
						<div class="row mb-3">
							<div class="pl-3 mt-1">
								<label for="date">Data od:</label>
							</div>	
							<div class="col-8">
								<input type="text" id="startDate" name="startDate" class="form-control"/>
							</div>
						</div>
							
						<div class="row">
							<div class="pl-3 mt-1">
								<label for="date">Data do:</label>
							</div>	
							<div class="col-8">
								<input type="text" id="endDate" name="endDate" class="form-control"/>
							</div>
						</div>
						
						<div id ="errorDate" class="error pl-5 ml-4"></div>
						
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" id="btn-show-balance">Pokaż</button>
						<button type="button" class="btn btn-danger btn-close" data-dismiss="modal">Zamknij</button>
					</div>
					
				</form>
				
			</div>
		</div>
	</div>
	
	<script>
		$(document).ready(function() {
			$('#selectDate').change(function() {
				if ($(this).val() == 4) {
					$('#errorDate').text('');
					$('#myModal').modal({backdrop: 'static'},"show");
					$('#btn-show-balance').click(function() {
						$.post("/profile/checkDates", 
						{startDate: $('#startDate').val(), endDate: $('#endDate').val()},function(data) {
							if (data == 'true') {
								$('#myModal').modal("hide");
								$('#modalForm').submit();
							} else {
								$('#errorDate').text('Invalid Date!');
							}
						});
					});
				} else {
					$('#balanceForm').submit();
				}
			});
		});
		
		$('.btn-close').click(function() {
			$('#selectDate').val(1);
			$('#balanceForm').submit();
		});
	</script>
{% endblock %}
